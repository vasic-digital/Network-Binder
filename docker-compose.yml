version: '3.8'

services:
  mptcp-router:
    build: .
    privileged: true
    network_mode: host
    volumes:
      - /etc/netplan:/etc/netplan
      - /sys/class/net:/sys/class/net:ro
      - ./config/mptcp:/etc/mptcp
    environment:
      - LAN_INTERFACE=${LAN_GATE_INTERFACE}
    restart: unless-stopped

  firewall:
    image: ubuntu:20.04
    network_mode: host
    volumes:
      - ./config/firewall:/etc/iptables
    command: ["sh", "-c", "apt-get update && apt-get install -y iptables && iptables-restore < /etc/iptables/rules.v4 && sleep infinity"]
    cap_add:
      - NET_ADMIN
    restart: unless-stopped
